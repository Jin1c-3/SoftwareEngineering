"use strict";(self["webpackChunkpleasuretour"]=self["webpackChunkpleasuretour"]||[]).push([[266],{2266:function(t,e,i){i.r(e),i.d(e,{default:function(){return v}});var a=function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{id:"selfOrder","element-loading-background":"#f8f8f8"}},[e("el-row",[e("h2",[t._v("订单信息")]),e("el-divider"),e("div",{staticClass:"row",staticStyle:{width:"100%","justify-content":"space-around","margin-bottom":"20px"}},[e("el-card",{staticStyle:{margin:"0 10px",flex:"1",height:"80px"}},[e("div",{staticClass:"row",staticStyle:{width:"100%","justify-content":"space-around","margin-bottom":"20px"}},[e("i",{staticClass:"el-icon-s-claim icon"}),e("div",{staticClass:"col"},[e("div",[t._v("已完成订单数")]),e("div",{staticStyle:{color:"#409eff","font-size":"20px"}},[t._v(" "+t._s(t.havePay.length)+" ")])])])]),e("el-card",{staticStyle:{margin:"0 10px",flex:"1",height:"80px"}},[e("div",{staticClass:"row",staticStyle:{width:"100%","justify-content":"space-around","margin-bottom":"20px"}},[e("i",{staticClass:"el-icon-s-order icon"}),e("div",{staticClass:"col"},[e("div",[t._v("待支付订单数")]),e("div",{staticStyle:{color:"#409eff","font-size":"20px"}},[t._v(" "+t._s(t.waitPay.length)+" ")])])])]),e("el-card",{staticStyle:{margin:"0 10px",flex:"1",height:"80px"}},[e("div",{staticClass:"row",staticStyle:{width:"100%","justify-content":"space-around","margin-bottom":"20px"}},[e("i",{staticClass:"el-icon-position icon"}),e("div",{staticClass:"col"},[e("div",[t._v("旅程长度")]),e("div",{staticStyle:{color:"#409eff","font-size":"20px"}},[t._v("1000公里")])])])])],1),e("h3",{staticStyle:{color:"#e6a23c"}},[t._v("等待支付")]),e("div",{staticStyle:{color:"#c0c4cc","font-size":"12px","margin-bottom":"10px"}},[t._v(" 目前处于排队等待支付的订单 ")]),t._l(t.waitPay,(function(i,a){return e("el-card",{key:a,staticStyle:{margin:"10px 0",height:"120px",position:"relative"},attrs:{shadow:"hover","body-style":"padding: 10px"}},[e("div",{staticClass:"col"},[e("div",{staticClass:"row",staticStyle:{width:"100%",height:"100px","justify-content":"start"}},[e("div",{staticClass:"el-icon-document-remove wait"}),e("strong",[t._v("订单编号："+t._s(i.orderId))]),e("el-statistic",{staticStyle:{width:"90px",position:"absolute",right:"10px",top:"10px"},attrs:{value:12e5+Date.parse(i.orderTime.toString().slice(0,19)),"time-indices":"",title:"剩余支付时间",format:"HH:mm:ss","value-style":{color:"red"}}},[e("template",{slot:"prefix"},[e("i",{staticClass:"el-icon-timer",staticStyle:{color:"red"}})])],2)],1)]),e("div",{staticStyle:{display:"flex","justify-content":"flex-end","align-items":"center"}},[12e5+Date.parse(i.orderTime.toString().slice(0,19))>0?e("el-button",{staticStyle:{position:"absolute",bottom:"10px",right:"10px"},attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.pay(i)}}},[t._v("继续支付")]):t._e()],1)])})),e("h3",{staticStyle:{color:"#67c23a"}},[t._v("已支付")]),e("div",{staticStyle:{color:"#c0c4cc","font-size":"12px","margin-bottom":"10px"}},[t._v(" 历史记录已支付的订单 ")]),t._l(t.havePay,(function(i,a){return e("el-card",{key:a,staticStyle:{margin:"10px 0",height:"120px",position:"relative"},attrs:{shadow:"hover","body-style":"padding: 10px"}},[e("div",{staticClass:"col"},[e("div",{staticClass:"row",staticStyle:{width:"100%",height:"100px","justify-content":"start"}},[e("div",{staticClass:"el-icon-document-checked have"}),e("strong",[t._v("订单编号："+t._s(i.orderId))])])]),e("div",{staticStyle:{display:"flex","justify-content":"flex-end","align-items":"center"}},[e("el-button",{staticStyle:{position:"absolute",bottom:"10px",right:"100px"},attrs:{type:"primary",size:"mini"},on:{click:function(e){t.reDialog=!0,t.getDetail(i)}}},[t._v("改签/退票")]),e("el-button",{staticStyle:{position:"absolute",bottom:"10px",right:"10px"},attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.getDetail(i)}}},[t._v("查看详情")])],1)])}))],2),e("el-dialog",{attrs:{title:"订单详情",visible:t.dialog},on:{"update:visible":function(e){t.dialog=e}}},["飞机"==t.details.vehicleType?e("div",[e("el-descriptions",{attrs:{direction:"vertical",column:3,border:""}},[e("el-descriptions-item",{attrs:{label:"订单编号",span:3}},[t._v(t._s(t.details.info[0].orderId))]),e("el-descriptions-item",{attrs:{label:"航班"}},[t._v(t._s(t.details.info[0].flightId))]),e("el-descriptions-item",{attrs:{label:"航线"}},[t._v(t._s(t.details.info[0].flightStartPort)+" -"+t._s(t.details.info[0].flightEndPort))]),e("el-descriptions-item",{attrs:{label:"时间"}},[t._v(t._s(t.details.info[0].flightStartTime.toString().slice(0,19))+" 至"+t._s(t.details.info[0].flightEndTime.toString().slice(0,19)))]),e("el-descriptions-item",{attrs:{label:"乘客"}},t._l(t.details.info,(function(i,a){return e("span",{key:a},[t._v(" "+t._s(i.passengerName)+" ")])})),0),e("el-descriptions-item",{attrs:{label:"座位"}},[t._v(t._s(t.details.info[0].seatType))]),e("el-descriptions-item",{attrs:{label:"价格"}},[t._v(t._s(t.details.info[0].flightPrice*t.details.info.length)+"￥")])],1)],1):"火车"==t.details.vehicleType?e("div",[e("el-descriptions",{attrs:{direction:"vertical",column:3,border:""}},[e("el-descriptions-item",{attrs:{label:"订单编号",span:3}},[t._v(t._s(t.details.info[0].orderId))]),e("el-descriptions-item",{attrs:{label:"车次"}},[t._v(t._s(t.details.info[0].trainNumberId))]),e("el-descriptions-item",{attrs:{label:"线路"}},[t._v(t._s(t.details.info[0].trainStartStation)+" -"+t._s(t.details.info[0].trainEndStation))]),e("el-descriptions-item",{attrs:{label:"时间"}},[t._v(t._s(t.details.info[0].trainTicketStartTime.toString().slice(0,19))+"至"+t._s(t.details.info[0].trainTicketEndTime.toString().slice(0,19))+" ")]),e("el-descriptions-item",{attrs:{label:"乘客"}},t._l(t.details.info,(function(i,a){return e("span",{key:a},[t._v(" "+t._s(i.passengerName)+" ")])})),0),e("el-descriptions-item",{attrs:{label:"座位"}},[t._v(t._s(t.details.info[0].seatType)+" ")]),e("el-descriptions-item",{attrs:{label:"价格"}},[t._v(t._s(t.details.info[0].trainPrice*t.details.info.length)+"￥")])],1)],1):t._e()]),e("el-dialog",{attrs:{title:"改签/退款",visible:t.reDialog},on:{"update:visible":function(e){t.reDialog=e}}},[e("el-popover",{attrs:{placement:"top-start",width:"900",trigger:"hover"}},[e("div",{staticStyle:{color:"#78bba0",width:"100px"},attrs:{slot:"reference"},slot:"reference"},[t._v(" 退改签说明 ")]),e("strong",[t._v("成人票")]),e("el-descriptions",{staticStyle:{width:"100%"},attrs:{title:"退票费",direction:"vertical",column:4,border:""}},[e("el-descriptions-item",{attrs:{label:">7天",contentStyle:"color: #ffd866"}},[t._v("10%")]),e("el-descriptions-item",{attrs:{label:"3-7天",contentStyle:"color: #ffd866"}},[t._v("30%")]),e("el-descriptions-item",{attrs:{label:"1-3天",contentStyle:"color: #ffd866"}},[t._v("50%")]),e("el-descriptions-item",{attrs:{label:"<1天",contentStyle:"color: #ffd866"}},[t._v("70%")])],1),e("el-descriptions",{staticStyle:{width:"100%"},attrs:{title:"同舱改期费",direction:"vertical",column:4,border:""}},[e("el-descriptions-item",{attrs:{label:">7天",contentStyle:"color: #ffd866"}},[t._v("5%")]),e("el-descriptions-item",{attrs:{label:"3-7天",contentStyle:"color: #ffd866"}},[t._v("15%")]),e("el-descriptions-item",{attrs:{label:"1-3天",contentStyle:"color: #ffd866"}},[t._v("35%")]),e("el-descriptions-item",{attrs:{label:"<1天",contentStyle:"color: #ffd866"}},[t._v("55%")])],1),e("div",{staticClass:"row",staticStyle:{margin:"10px 0"}},[e("strong",[t._v("签转条件")]),e("div",[t._v("不得签转")])]),e("div",{staticClass:"row"},[e("strong",[t._v("行李额")]),e("div",{staticClass:"col"},[e("div",[t._v(" 免费手提行李额：每件10KG,每人1件。单件行李质量不超过10KG,单件体积不超过20*40*55CM ")]),e("div",[t._v(" 免费托运行李额：每件23KG,每人1件。单件托运行李质量不超过50KG,单件体积不超过40*60*100CM ")])])]),e("div",{staticClass:"row",staticStyle:{margin:"10px 0"}},[e("strong",[t._v("报销凭证")]),e("div",[t._v(" 可提供”行程单”作为报销凭证，凭证金颜以实际开具金额为准， 支付成功后可查看订单并开具凭证 ")])]),e("div",{staticClass:"row",staticStyle:{margin:"10px 0"}},[e("strong",[t._v("航司备注")]),e("div",{staticStyle:{width:"700px"}},[t._v(" 手提行李标准：单件重量不能超过10千克且体积不能超过20×40×55厘米可带入客舱的行李箱。如果单件手提行李体积超过20×40×55厘 米，或重量超过10千克的，需办理行李托运。托运行李标准：单件重量不能超过50千克且单件体积不能超过40×60×100厘米。单件体积 超过40×60×100厘米的行李需按照特殊行李执行或须事先征得同意方能托运。 ")])]),e("div",{staticClass:"row",staticStyle:{margin:"10px 0"}},[e("strong",[t._v("备注")]),e("div",[t._v(" 航班延误或取消，不提供经济补偿。航班取消、延误15分钟以上可按非自愿退票办理 ")])])],1),e("el-tabs",{attrs:{stretch:!0},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[e("el-tab-pane",{attrs:{label:"改签",name:"first"}},[e("div",{directives:[{name:"loading",rawName:"v-loading",value:!0,expression:"true"}],staticStyle:{width:"100%",height:"200px"}})]),e("el-tab-pane",{attrs:{label:"退款",name:"second"}},[e("div",{staticStyle:{width:"100%",height:"200px",position:"relative",overflow:"hidden"}},[e("el-select",{staticStyle:{position:"absolute",top:"10px",left:"calc(50% - 100px)",width:"200px"},attrs:{placeholder:"退款理由"},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}},t._l(t.options,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1),e("el-button",{staticStyle:{position:"absolute",bottom:"10px",left:"calc(50% - 100px)",width:"200px"},attrs:{type:"primary"},on:{click:t.refund}},[t._v("申请退款")])],1)])],1)],1),e("div",{ref:"alipay",domProps:{innerHTML:t._s(t.alipay)}})],1)},s=[],l=i(4161),o=i(8568),r=i(3822),n={data(){return{loading:!0,dialog:!1,orderList:[],havePay:"",waitPay:"",details:"",alipay:"",reDialog:!1,activeName:"first",options:[{value:"行程改变",label:"行程改变"},{value:"价格变动",label:"价格变动"},{value:"航班延误",label:"航班延误"},{value:"其他原因",label:"其他原因"}],value:""}},methods:{...(0,r.nv)("login",{getInfo:"getInfo"}),getOrders(){(0,l.Z)({method:"get",url:`${o.Z.url}/whole-order/getOrder`,headers:{token:localStorage.getItem("token")},params:{usrId:this.$store.state.user.userForm.usrId}}).then((t=>{console.log(t.data.data),this.orderList=t.data.data,this.havePay=this.orderList.filter((t=>"已支付"==t.orderStatus)),this.waitPay=this.orderList.filter((t=>"未支付"==t.orderStatus))})).catch((t=>{console.log(t)}))},details(){this.dialog=!0},getDetail(t){let e=o.Z.url+("飞机"==t.vehicleType?"/aircraft/query-aircraft-ticket":"/train/query-train-ticket");(0,l.Z)({method:"get",url:e,headers:{token:localStorage.getItem("token")},params:{orderId:t.orderId}}).then((e=>{console.log(e.data.data),this.details=e.data.data,this.details={info:this.details,vehicleType:t.vehicleType},console.log(this.details)})).catch((t=>{console.log(t)}))},pay(t){(0,l.Z)({method:"get",url:`${o.Z.url}/whole-order/alipayContinue`,headers:{token:localStorage.getItem("token")},params:{orderId:t.orderId}}).then((t=>{this.alipay=t.data.data,this.$nextTick((()=>{this.$refs.alipay.children[0].submit()}))})).catch((t=>{console.log(t)}))},refund(){console.log(this.details),(0,l.Z)({method:"post",url:`${o.Z.url}/usr/alipay-refund`,headers:{token:localStorage.getItem("token")},params:{orderId:this.details.info[0].orderId,money:"火车"==this.details.vehicleType?this.details.info[0].trainPrice*this.details.info.length:this.details.info[0].flightPrice*this.details.info.length,reason:this.value}}).then((t=>{console.log(t.data.data),200==t.data.code?(this.$message({message:"退款成功",type:"success"}),this.reDialog=!1,this.getOrders()):this.$message({message:t.data.msg,type:"error"})})).catch((t=>{console.log(t)}))}},activated(){this.getInfo(this),this.getOrders(),setTimeout((()=>{this.loading=!1}),1e3)},deactivated(){console.log("deactivated"),this.loading=!0}},c=n,d=i(1001),p=(0,d.Z)(c,a,s,!1,null,"082dd75e",null),v=p.exports}}]);
//# sourceMappingURL=266.8b1c7269.js.map