"use strict";(self["webpackChunkpleasuretour"]=self["webpackChunkpleasuretour"]||[]).push([[15],{2015:function(t,e,i){i.r(e),i.d(e,{default:function(){return g}});var a=function(){var t=this,e=t._self._c;return e("div",[e("div",{ref:"headBackground",staticClass:"head-background"},[e("strong",{staticStyle:{"font-size":"50px"}},[t._v("火车")])]),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{overflow:"auto",height:"900px"}},[e("el-row",{staticClass:"search-nav",attrs:{type:"flex",justify:"center"}},[e("el-col",{attrs:{xs:20,sm:18,md:16,lg:12,xl:12}},[e("el-card",{staticClass:"search-nav-el-card",staticStyle:{position:"relative",overflow:"visible"},attrs:{shadow:"always","body-style":{padding:0}}},[e("el-row",{staticStyle:{height:"100px"},attrs:{type:"flex",justify:"space-around",align:"middle"}},[e("el-col",{attrs:{xs:8,sm:8,md:5,lg:5,xl:5}},[e("el-cascader",{staticStyle:{outline:"none",border:"none","box-shadow":"none"},attrs:{placeholder:"出发地",options:t.options,filterable:"",props:t.search.pro,clearable:!0,"show-all-levels":!1},model:{value:t.search.from,callback:function(e){t.$set(t.search,"from",e)},expression:"search.from"}})],1),e("el-col",{attrs:{xs:8,sm:8,md:5,lg:5,xl:5}},[e("el-cascader",{attrs:{placeholder:"目的地",options:t.options,filterable:"",props:t.search.pro,clearable:!0,"show-all-levels":!1},model:{value:t.search.to,callback:function(e){t.$set(t.search,"to",e)},expression:"search.to"}})],1),e("el-col",{attrs:{xs:8,sm:8,md:5,lg:5,xl:5}},[e("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"选择日期",editable:"",clearable:!0,"value-format":"yyyy-MM-dd"},model:{value:t.search.date,callback:function(e){t.$set(t.search,"date",e)},expression:"search.date"}})],1)],1),e("el-button",{staticStyle:{position:"absolute",bottom:"-20px",left:"50%","z-index":"2",width:"150px",transform:"translateX(-75px)"},attrs:{icon:"el-icon-search",round:"",type:"primary"},on:{click:t.searchFilter}},[t._v("搜索")])],1)],1)],1),t.isShow?e("el-row",{staticStyle:{margin:"20px 0"},attrs:{type:"flex",justify:"center"}},[e("el-col",{attrs:{xs:20,sm:18,md:16,lg:14,xl:14}},[e("el-card",{staticClass:"filter-el-card",attrs:{shadow:"always","body-style":{padding:"5px"}}},[e("div",{staticStyle:{display:"flex","justify-content":"end","align-items":"center",height:"100%"}},[e("el-select",{staticStyle:{width:"120px",margin:"0 10px"},attrs:{placeholder:"价格",clearable:!0},model:{value:t.listQuery.price,callback:function(e){t.$set(t.listQuery,"price",e)},expression:"listQuery.price"}},t._l(t.priceOptions,(function(t,i){return e("el-option",{key:i,attrs:{label:t,value:t}})})),1),e("el-select",{staticStyle:{width:"120px",margin:"0 10px"},attrs:{placeholder:"耗时",clearable:!0},model:{value:t.listQuery.time,callback:function(e){t.$set(t.listQuery,"time",e)},expression:"listQuery.time"}},t._l(t.timeOptions,(function(t,i){return e("el-option",{key:i,attrs:{label:t,value:t}})})),1),e("el-select",{staticStyle:{width:"140px",margin:"0 10px"},attrs:{placeholder:"出发时间",clearable:!0},model:{value:t.listQuery.depart,callback:function(e){t.$set(t.listQuery,"depart",e)},expression:"listQuery.depart"}},t._l(t.departOptions,(function(t,i){return e("el-option",{key:i,attrs:{label:t,value:t}})})),1),e("el-select",{staticStyle:{width:"140px",margin:"0 10px"},attrs:{placeholder:"到达时间",clearable:!0},model:{value:t.listQuery.arrive,callback:function(e){t.$set(t.listQuery,"arrive",e)},expression:"listQuery.arrive"}},t._l(t.arriveOptions,(function(t,i){return e("el-option",{key:i,attrs:{label:t,value:t}})})),1),e("el-button",{staticClass:"el-icon-search",attrs:{slot:"reference",circle:!0},on:{click:t.handlerFilter},slot:"reference"})],1)])],1)],1):t._e(),t.isShow?e("el-row",{staticClass:"nav",attrs:{type:"flex",justify:"center"}},[e("el-col",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.loadLimit,expression:"loadLimit"}],attrs:{xs:20,sm:18,md:16,lg:14,xl:14}},t._l(t.trainsPart,(function(a,r){return e("div",{key:r},[e("el-card",{staticClass:"info-el-card",attrs:{shadow:"always","body-style":{padding:0}}},[e("el-row",{staticStyle:{height:"120px"},attrs:{type:"flex",justify:"space-between",align:"middle"}},[e("el-col",{attrs:{xs:10,sm:8,md:10,lg:10,xl:10}},[e("el-popover",{attrs:{placement:"top",title:"车次信息",width:"300",trigger:"hover"}},[e("el-divider"),e("div",[e("el-timeline",[e("el-timeline-item",{attrs:{timestamp:a[0].trainLeaveTime.toString().slice(0,5)+" "+a[0].trainArriveCity+" "+a[0].trainArriveStation+"火车站 "+a[0].trainNumberId,placement:"top",color:"#54c8f4"}},[e("el-card",[t._v("行程时长"+t._s(t.timeFilter(a[0].trainLeaveTime,a[1].trainArriveTime)))])],1),e("el-timeline-item",{attrs:{timestamp:a[1].trainArriveTime.toString().slice(0,5)+" "+a[1].trainArriveCity+" "+a[1].trainArriveStation+"火车站 "+a[0].trainNumberId,placement:"top",color:"#54c8f4"}}),a.length>2?e("el-timeline-item",{attrs:{timestamp:a[2].trainLeaveTime.toString().slice(0,5)+" "+a[2].trainArriveCity+" "+a[2].trainArriveStation+"火车站 "+a[0].trainNumberId,placement:"top",color:"#54c8f4"}},[e("el-card",[t._v("行程时长"+t._s(t.timeFilter(a[2].trainLeaveTime,a[3].trainArriveTime)))])],1):t._e(),a.length>2?e("el-timeline-item",{attrs:{timestamp:a[3].trainArriveTime.toString().slice(0,5)+" "+a[3].trainArriveCity+" "+a[3].trainArriveStation+"火车站 "+a[3].trainNumberId,placement:"top",color:"#54c8f4"}}):t._e()],1)],1),e("div",{staticClass:"row",attrs:{slot:"reference"},slot:"reference"},[e("div",{staticClass:"col"},[e("h3",[t._v(t._s(a[0].trainArriveCity.slice(0,2)))]),e("div",[t._v(t._s(a[0].trainLeaveTime.slice(0,5)))])]),e("div",{staticClass:"col"},[a.length>2?e("div",{staticStyle:{transform:"translate(0, 10px)",color:"#54c8f4","font-size":"18px","font-weight":"bold"}},[t._v(" 换乘 ")]):t._e(),e("el-image",{staticStyle:{margin:"0 10px",width:"80px",height:"30px"},attrs:{src:i(7139)}}),t.compareTime(a)?e("div",{staticStyle:{transform:"translate(0, -5px)",color:"#54c8f4","font-size":"15px","font-weight":"bold"}},[t._v(" >1天 ")]):t._e()],1),e("div",{staticClass:"col"},[e("h3",[t._v(" "+t._s(a[typeof a[3]==Object?3:1].trainArriveCity.slice(0,2))+" ")]),e("div",[t._v(" "+t._s(a[typeof a[3]==Object?3:1].trainArriveTime.slice(0,5))+" ")])])])],1)],1),e("el-col",{attrs:{xs:5,sm:3,md:3,lg:3,xl:3}},[e("h3",{staticClass:"price",staticStyle:{color:"#409eff","font-size":"25px"}},[t._v(" "+t._s(typeof a[3]==Object?a[3].trainOnePrice+a[1].trainOnePrice-a[2].trainOnePrice-a[0].trainOnePrice:a[1].trainOnePrice-a[0].trainOnePrice)+"￥ ")])]),e("el-col",{attrs:{xs:4,sm:3,md:3,lg:3,xl:3}},[e("el-button",{staticClass:"el-icon-arrow-down",attrs:{type:"primary",size:"medium"},on:{click:function(e){a.show=!a.show,t.showType(r)}}},[t._v("订购")])],1)],1)],1),a.show?e("el-card",[e("div",{staticClass:"col"},[a[1].trainOnePrice>0?e("div",{staticClass:"row",staticStyle:{width:"100%","justify-content":"end",margin:"10px 0"}},[a.seat.lseat>=10?e("el-tag",{attrs:{type:"success"}},[t._v("余票充足")]):t._e(),a.seat.lseat<10?e("el-tag",{attrs:{type:"warning"}},[t._v("仅剩 "+t._s(a.seat.lseat)+" 张")]):t._e(),e("div",{staticClass:"col"},[e("div",{staticStyle:{color:"#409eff"}},[t._v("硬座")]),e("div",{staticStyle:{color:"#409eff"}},[t._v(" "+t._s(typeof a[3]==Object?a[3].trainOnePrice+a[1].trainOnePrice-a[2].trainOnePrice-a[0].trainOnePrice:a[1].trainOnePrice-a[0].trainOnePrice)+"￥ ")])]),e("button",{staticClass:"payButton",staticStyle:{"margin-left":"20px"},on:{click:function(e){return t.order(a,0)}}},[t._v(" 预定 ")])],1):t._e(),a[1].trainTwoPrice>0?e("div",{staticClass:"row",staticStyle:{width:"100%","justify-content":"end",margin:"10px 0"}},[a.seat.mseat>=10?e("el-tag",{attrs:{type:"success"}},[t._v("余票充足")]):t._e(),a.seat.mseat<10?e("el-tag",{attrs:{type:"warning"}},[t._v("仅剩 "+t._s(a.seat.mseat)+" 张")]):t._e(),e("div",{staticClass:"col"},[e("div",{staticStyle:{color:"#409eff"}},[t._v("硬卧")]),e("div",{staticStyle:{color:"#409eff"}},[t._v(" "+t._s(typeof a[3]==Object?a[3].trainTwoPrice+a[1].trainTwoPrice-a[2].trainTwoPrice-a[0].trainTwoPrice:a[1].trainTwoPrice-a[0].trainTwoPrice)+"￥ ")])]),e("button",{staticClass:"payButton",staticStyle:{"margin-left":"20px"},on:{click:function(e){return t.order(a,1)}}},[t._v(" 预定 ")])],1):t._e(),a[1].trainSpPrice>0?e("div",{staticClass:"row",staticStyle:{width:"100%","justify-content":"end",margin:"10px 0"}},[a.seat.hseat>=10?e("el-tag",{attrs:{type:"success"}},[t._v("余票充足")]):t._e(),a.seat.hseat<10?e("el-tag",{attrs:{type:"warning"}},[t._v("仅剩 "+t._s(a.seat.hseat)+" 张")]):t._e(),e("div",{staticClass:"col"},[e("div",{staticStyle:{color:"#409eff"}},[t._v("软座")]),e("div",{staticStyle:{color:"#409eff"}},[t._v(" "+t._s(typeof a[3]==Object?a[3].trainSpPrice+a[1].trainSpPrice-a[2].trainSpPrice-a[0].trainSpPrice:a[1].trainSpPrice-a[0].trainSpPrice)+"￥ ")])]),e("button",{staticClass:"payButton",staticStyle:{"margin-left":"20px"},on:{click:function(e){return t.order(a,2)}}},[t._v(" 预定 ")])],1):t._e(),a[1].trainOneSsPrice>0?e("div",{staticClass:"row",staticStyle:{width:"100%","justify-content":"end",margin:"10px 0"}},[a.seat.tseat>=10?e("el-tag",{attrs:{type:"success"}},[t._v("余票充足")]):t._e(),a.seat.tseat<10?e("el-tag",{attrs:{type:"warning"}},[t._v("仅剩 "+t._s(a.seat.tseat)+" 张")]):t._e(),e("div",{staticClass:"col"},[e("div",{staticStyle:{color:"#409eff"}},[t._v("软卧")]),e("div",{staticStyle:{color:"#409eff"}},[t._v(" "+t._s(typeof a[3]==Object?a[3].trainSspPrice+a[1].trainSspPrice-a[2].trainSspPrice-a[0].trainSspPrice:a[1].trainSspPrice-a[0].trainSspPrice)+"￥ ")])]),e("button",{staticClass:"payButton",staticStyle:{"margin-left":"20px"},on:{click:function(e){return t.order(a,3)}}},[t._v(" 预定 ")])],1):t._e()])]):t._e()],1)})),0)],1):t._e(),e("div",{staticStyle:{display:"flex","justify-content":"center","align-items":"center",position:"fixed",left:"50%",bottom:"20px"}},[e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.isInfiniteLoading,expression:"isInfiniteLoading"}],staticStyle:{height:"40px",width:"40px"}})]),t.cardLoading?e("div",{staticClass:"loading"}):t._e()],1),e("el-dialog",{attrs:{title:"订单",visible:t.dialog,"append-to-body":"",fullscreen:"",width:"700px",customClass:"customWidth"},on:{"update:visible":function(e){t.dialog=e},open:t.initOrder}},[e("div",{staticClass:"col"},[e("el-steps",{staticStyle:{width:"900px",background:"#fff"},attrs:{active:t.active,"align-center":""}},[e("el-step",{attrs:{title:"车票信息"}}),e("el-step",{attrs:{title:"增值服务"}}),e("el-step",{attrs:{title:"支付"}})],1),e("el-divider"),0==t.active?e("div",{staticStyle:{width:"100%",height:"700px"}},[e("div",{staticClass:"row"},[e("div",{staticClass:"col"},[e("el-card",{staticStyle:{width:"800px",height:"550px","overflow-y":"auto"},attrs:{header:"乘客"}},[e("div",{staticClass:"col"},[t._l(t.orderInfo.passengers,(function(i,a){return e("el-card",{key:a,staticStyle:{width:"100%",height:"150px","margin-bottom":"20px",position:"relative"},attrs:{"body-style":"padding: 0",shadow:"hover"}},[e("div",{staticClass:"row",staticStyle:{"justify-content":"start","align-items":"start"}},[e("h1",{staticStyle:{margin:"10px 30px",color:"#409eff"}},[t._v(" "+t._s(a)+" ")]),e("div",{staticStyle:{width:"2px",height:"140px",background:"#eee",margin:"5px 10px"}}),e("el-form",{ref:"passengerForm",refInFor:!0,staticStyle:{"margin-top":"10px"},attrs:{model:i,"label-width":"100px",rules:t.rules}},[e("el-form-item",{attrs:{label:"姓名",size:"mini",prop:"passengerName"}},[e("el-input",{attrs:{size:"mini",placeholder:"乘客姓名"},model:{value:i.passengerName,callback:function(e){t.$set(i,"passengerName",e)},expression:"passenger.passengerName"}})],1),e("el-form-item",{attrs:{label:"身份证",size:"mini",prop:"passengerId"}},[e("el-input",{attrs:{size:"mini",placeholder:"乘客身份证号"},model:{value:i.passengerId,callback:function(e){t.$set(i,"passengerId",e)},expression:"passenger.passengerId"}})],1),e("el-form-item",{attrs:{label:"联系电话",size:"mini",prop:"phoneNumber"}},[e("el-input",{attrs:{size:"mini",placeholder:"乘客电话号码"},model:{value:i.phoneNumber,callback:function(e){t.$set(i,"phoneNumber",e)},expression:"passenger.phoneNumber"}})],1)],1),e("el-button",{staticClass:"el-icon-close",staticStyle:{"font-size":"30px",color:"#409eff",position:"absolute",right:"10px",top:"0"},attrs:{type:"text"},on:{click:function(e){return t.deletePassenger(a)}}})],1)])})),e("el-button",{staticClass:"el-icon-circle-plus-outline",staticStyle:{"font-size":"20px",color:"#409eff"},attrs:{type:"text"},on:{click:t.addPassenger}},[t._v("增加乘客")])],2)]),e("el-card",{staticStyle:{width:"800px",height:"120px","margin-top":"20px"},attrs:{header:"联系人"}},[e("div",{staticClass:"col"},[e("el-form",{ref:"contactForm",attrs:{model:t.orderInfo.contact,"label-width":"100px",rules:t.contactRules}},[e("el-form-item",{attrs:{label:"联系电话",size:"mini",prop:"phone"}},[e("el-input",{staticStyle:{width:"300px","margin-right":"20px"},attrs:{size:"mini",placeholder:"联系人电话号码"},model:{value:t.orderInfo.contact.phone,callback:function(e){t.$set(t.orderInfo.contact,"phone",e)},expression:"orderInfo.contact.phone"}}),e("div",{staticClass:"el-icon-warning",staticStyle:{color:"#7c7c7c"}},[t._v(" 订单信息将发送到此手机号 ")])],1)],1)],1)])],1),e("el-card",{staticStyle:{width:"400px",height:"700px","margin-left":"20px"},attrs:{header:"信息"}},[e("div",{staticClass:"col"},[e("h2",[t._v(" "+t._s(t.search.date+" "+t.bookTrain.from+"-"+t.bookTrain.to)+" ")]),e("h2",[t._v(t._s(t.bookTrain.trainId))]),e("el-divider"),t._l(t.orderInfo.passengers,(function(i,a){return e("div",{key:a,staticStyle:{width:"100%","margin-bottom":"10px"}},[e("div",{staticClass:"col"},[e("div",{staticClass:"row",staticStyle:{width:"100%","justify-content":"space-between"}},[e("div",[t._v(t._s(t.bookTrain.trainType))]),e("div",[t._v(t._s(t.bookTrain.price)+"￥")])])])])})),e("el-divider"),e("h1",{staticStyle:{width:"100%","text-align":"right","font-size":"20px"}},[t._v(" "+t._s(t.bookTrain.price*t.orderInfo.passengers.length)+"￥ ")])],2)])],1)]):t._e(),1==t.active?e("div",{staticStyle:{width:"100%",height:"700px"}},[e("el-alert",{staticStyle:{"margin-bottom":"20px"},attrs:{title:"增值服务为自助选择业务，不影响您的火车预订，所有增值服务解释权归铁路部门所有。",type:"warning","show-icon":""}}),e("el-card",{staticStyle:{width:"100%",height:"640px"},attrs:{header:"增值服务"}},[e("el-empty",{attrs:{description:"暂无可用增值服务"}})],1)],1):t._e(),2==t.active?e("div",{staticStyle:{width:"100%",height:"700px"}},[e("el-card",{staticStyle:{width:"100%",height:"700px",position:"relative"},attrs:{header:"支付"}},[e("div",{staticStyle:{display:"flex:justify-content:start","align-items":"center","flex-direction":"column"}},[e("div",{staticStyle:{"margin-bottom":"20px","font-size":"18px"}},[t._v("支付方式")]),e("div",{staticClass:"display: flex; justify-content: start; align-items: center;"},[e("div",{staticStyle:{"margin-top":"40px","font-size":"16px"}},[t._v("移动支付")]),e("el-divider"),e("el-radio-group",{model:{value:t.paySelect,callback:function(e){t.paySelect=e},expression:"paySelect"}},[e("el-radio",{attrs:{label:"支付宝"}},[t._v("支付宝")]),e("el-radio",{attrs:{label:"微信"}},[t._v("微信")]),e("el-radio",{attrs:{label:"银联"}},[t._v("银联")])],1),e("div",{staticStyle:{"margin-top":"40px","font-size":"16px"}},[t._v("银行卡支付")]),e("el-divider"),e("el-radio-group",{model:{value:t.paySelect,callback:function(e){t.paySelect=e},expression:"paySelect"}},[e("el-radio",{attrs:{label:"中国银行"}},[t._v("中国银行")]),e("el-radio",{attrs:{label:"工商银行"}},[t._v("工商银行")]),e("el-radio",{attrs:{label:"建设银行"}},[t._v("建设银行")]),e("el-radio",{attrs:{label:"农业银行"}},[t._v("农业银行")]),e("el-radio",{attrs:{label:"交通银行"}},[t._v("交通银行")])],1)],1)]),e("div",{staticClass:"el-icon-warning",staticStyle:{color:"#9a9b9c",position:"absolute",bottom:"20px",right:"20px"}},[t._v(" 订单生效起20分钟内可支付，逾期将自动取消 ")]),e("div",{ref:"alipay",domProps:{innerHTML:t._s(t.alipay)}})]),e("div",{staticClass:"row",staticStyle:{width:"100%",height:"40px","justify-content":"end","margin-top":"20px"}},[e("h1",{staticStyle:{color:"red"}},[t._v("总计：")]),e("div",{staticStyle:{"font-size":"20px","font-weight":"bold",color:"#fc9867","margin-right":"20px"}},[t._v(" "+t._s(t.bookTrain.price*t.orderInfo.passengers.length)+"￥ ")]),e("button",{staticClass:"payButton",on:{click:t.pay}},[t._v("立即支付")])])],1):t._e(),e("div",{staticClass:"row",staticStyle:{"margin-top":"10px"}},[t.active>0&&t.active<2?e("el-button",{staticStyle:{width:"300px","margin-right":"20px"},attrs:{type:"primary"},on:{click:t.last}},[t._v("上一步")]):t._e(),t.active<2?e("el-button",{staticStyle:{width:"300px"},attrs:{type:"primary"},on:{click:t.next}},[t._v("下一步")]):t._e()],1)],1)])],1)},r=[],s=(i(7658),i(9325)),n=i(3822),l=i(4161),o=i(8568),c={name:"YTrain",data(){return{limit:10,loading:!0,cardLoading:!1,isInfiniteLoading:!1,options:s.Z.trainOptions,isShow:!1,trains:[],trainsPart:[],bookTrain:{from:"",startTime:"",to:"",endTime:"",trainId:"",date:"",price:"",trainType:""},search:{from:"",to:"",date:"",pro:{expandTrigger:"hover"}},timeOptions:["耗时升序","耗时降序"],priceOptions:["价格升序","价格降序"],arriveOptions:["到达时间升序","到达时间降序"],departOptions:["出发时间升序","出发时间降序"],listQuery:{time:"",price:"",arrive:"",depart:""},rules:{passengerName:[{required:!0,message:"请输入姓名",trigger:"blur"},{min:2,max:10,message:"长度在 2 到 10 个字符",trigger:"blur"}],passengerId:[{required:!0,message:"请输入身份证号",trigger:"blur"},{min:18,max:18,message:"长度为 18 个字符",trigger:"blur"}],phoneNumber:[{required:!0,message:"请输入手机号",trigger:"blur"},{min:11,max:11,message:"长度为 11 个字符",trigger:"blur"}]},contactRules:{phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{min:11,max:11,message:"长度为 11 个字符",trigger:"blur"}]},dialog:!1,active:0,orderInfo:{passengers:[{name:"",id:"",phone:""}],contact:{phone:""}},alipay:"",paySelect:"",paySelect:""}},methods:{...(0,n.OI)("login",{changeLoginDialog:"changeLoginDialog"}),getPassegers(){(0,l.Z)({url:`${o.Z.url}/passenger/findPsgByUsrId`,headers:{token:localStorage.getItem("token")},params:{usrId:this.$store.state.user.userForm.usrId}}).then((t=>{200==t.data.code?(this.orderInfo.passengers=t.data.data,this.orderInfo.passengers.filter((t=>"飞机"==t.passengerType))):this.$message({message:t.data.message,type:"error",duration:1e3})})).catch((t=>{this.$message({message:t,type:"error",duration:1e3})}))},loadLimit(){console.log("loadLimit"),this.limit+=5,this.trainsPart=this.trains.slice(0,this.limit),this.isInfiniteLoading=!0,setTimeout((()=>{this.isInfiniteLoading=!1}),500)},searchFilter(){""!=this.search.from&&""!=this.search.to?this.search.from[2]!=this.search.to[2]?""!=this.search.date?(this.$refs.headBackground.style.height="0px",this.cardLoading=!0,this.isShow=!1,(0,l.Z)({url:`${o.Z.url}/train/query-train`,method:"post",headers:{token:localStorage.getItem("token")},data:{startCityOrStation:this.search.from[2],endCityOrStation:this.search.to[2],leaveYearMonthDay:this.search.date}}).then((t=>{200==t.data.code?t.data.data.length>0?(console.log(t.data.data),this.trains=t.data.data,this.trainsPart=this.trains.slice(0,this.limit),this.cardLoading=!1,this.isShow=!0):this.$message({message:t.data.message,type:"warning",duration:1e3}):this.$message({message:t.data.message,type:"error",duration:1e3})})).catch((t=>{this.$message({message:t,type:"error",duration:1e3})})),1==this.cardLoading&&setTimeout((()=>{this.cardLoading=!1}),800)):this.$message({message:"出发日期不能为空",type:"error",duration:1e3}):this.$message({message:"出发地和目的地不能相同",type:"error",duration:1e3}):this.$message({message:"出发地和目的地不能为空",type:"error",duration:1e3})},handlerFilter(){""!=this.listQuery.price&&("价格升序"==this.listQuery.price?this.trains.sort(((t,e)=>t[t.length-1].trainOnePrice-t[0].trainOnePrice-(e[e.length-1].trainOnePrice-e[0].trainOnePrice))):"价格降序"==this.listQuery.price&&this.trains.sort(((t,e)=>e[e.length-1].trainOnePrice-e[0].trainOnePrice-(t[t.length-1].trainOnePrice-t[0].trainOnePrice)))),""!=this.listQuery.time&&("耗时升序"==this.listQuery.time?this.trains.sort(((t,e)=>Date.parse(`1900-01-01 ${t[t.length-1].trainArriveTime.toString().slice(0,5)}`)-Date.parse(`1900-01-01 ${t[0].trainLeaveTime.toString().slice(0,5)}`)-(Date.parse(`1900-01-01 ${e[e.length-1].trainArriveTime.toString().slice(0,5)}`)-Date.parse(`1900-01-01 ${e[0].trainLeaveTime.toString().slice(0,5)}`)))):"耗时降序"==this.listQuery.time&&this.trains.sort(((t,e)=>Date.parse(`1900-01-01 ${e[e.length-1].trainArriveTime.toString().slice(0,5)}`)-Date.parse(`1900-01-01 ${e[0].trainLeaveTime.toString().slice(0,5)}`)-(Date.parse(`1900-01-01 ${t[t.length-1].trainArriveTime.toString().slice(0,5)}`)-Date.parse(`1900-01-01 ${t[0].trainLeaveTime.toString().slice(0,5)}`))))),""!=this.listQuery.arrive&&("到达时间升序"==this.listQuery.arrive?this.trains.sort(((t,e)=>Date.parse(`1900-01-01 ${t[t.length-1].trainArriveTime.toString().slice(0,5)}`)-Date.parse(`1900-01-01 ${e[e.length-1].trainArriveTime.toString().slice(0,5)}`))):"到达时间降序"==this.listQuery.arrive&&this.trains.sort(((t,e)=>Date.parse(`1900-01-01 ${e[e.length-1].trainArriveTime.toString().slice(0,5)}`)-Date.parse(`1900-01-01 ${t[t.length-1].trainArriveTime.toString().slice(0,5)}`)))),""!=this.listQuery.depart&&("出发时间升序"==this.listQuery.depart?this.trains.sort(((t,e)=>Date.parse(`1900-01-01 ${t[0].trainLeaveTime.toString().slice(0,5)}`)-Date.parse(`1900-01-01 ${e[0].trainLeaveTime.toString().slice(0,5)}`))):"出发时间降序"==this.listQuery.depart&&this.trains.sort(((t,e)=>Date.parse(`1900-01-01 ${e[0].trainLeaveTime.toString().slice(0,5)}`)-Date.parse(`1900-01-01 ${t[0].trainLeaveTime.toString().slice(0,5)}`)))),this.trainsPart=this.trains.slice(0,this.limit)},order(t,e){if(0==this.$store.state.login.loginState)this.changeLoginDialog(),this.$message({message:"请先登录",type:"warning"});else if(this.active=0,this.dialog=!0,this.getPassegers(),this.bookTrain.from=t[0].trainArriveCity.slice(0,2),this.bookTrain.startTime=t[0].trainLeaveTime,this.bookTrain.to=t[typeof t[3]==Object?3:1].trainArriveCity.slice(0,2),this.bookTrain.endTime=t[typeof t[3]==Object?3:1].trainArriveTime,this.bookTrain.trainId=t[0].trainNumberId,this.bookTrain.date=this.search.date,typeof t[3]!=Object)switch(e){case 0:this.bookTrain.price=t[1].trainOnePrice-t[0].trainOnePrice,this.bookTrain.trainType="硬座";break;case 1:this.bookTrain.price=t[1].trainTwoPrice-t[0].trainTwoPrice,this.bookTrain.trainType="硬卧";break;case 2:this.bookTrain.price=t[1].trainSpPrice-t[0].trainSpPrice,this.bookTrain.trainType="软座";break;case 3:this.bookTrain.price=t[1].trainSspPrice-t[0].trainSspPrice,this.bookTrain.trainType="软卧";break}else switch(e){case 0:this.bookTrain.price=t[3].trainOnePrice+t[1].trainOnePrice-t[0].trainOnePrice-t[2].trainOnePrice,this.bookTrain.trainType="硬座";break;case 1:this.bookTrain.price=t[3].trainTwoPrice+t[1].trainTwoPrice-t[0].trainTwoPrice-t[2].trainTwoPrice,this.bookTrain.trainType="硬卧";break;case 2:this.bookTrain.price=t[3].trainSpPrice+t[1].trainSpPrice-t[0].trainSpPrice-t[2].trainSpPrice,this.bookTrain.trainType="软座";break;case 3:this.bookTrain.price=t[3].trainSspPrice+t[1].trainSspPrice-t[0].trainSspPrice-t[2].trainSspPrice,this.bookTrain.trainType="软卧";break}},next(){if(this.active<3)if(0==this.active){if(0==this.orderInfo.passengers.length)return void this.$message({message:"请添加乘客",type:"warning"});let t=!0;if(console.log(this.$refs),this.$refs.passengerForm.forEach((e=>{console.log(e),e.validate((e=>{e||(t=!1)}))})),!t)return void this.$message({message:"请填写正确的乘客信息",type:"warning"});this.$refs.contactForm.validate((t=>{t?(this.addPassengers(),this.active++):this.$message({message:"请填写联系人信息",type:"warning"})}))}else(1==this.active||2==this.active)&&this.active++},last(){this.active>0&&this.active--},initOrder(){this.orderInfo={passengers:[{name:"",id:"",phone:""}],contact:{phone:""}}},addPassenger(){let t={name:"",id:"",phone:""};this.orderInfo.passengers.push(t)},addPassengers(){(0,l.Z)({method:"post",url:`${o.Z.url}/passenger/addPassengerList`,headers:{token:localStorage.getItem("token")},data:this.orderInfo.passengers})},deletePassenger(t){this.orderInfo.passengers.splice(t,1)},pay(){if("支付宝"==this.paySelect){const t={vehicleType:"火车",flightOrTrainNO:this.bookTrain.trainId,startPortOrStation:this.bookTrain.from,endPortOrStation:this.bookTrain.to,startTime:this.search.date+" "+this.bookTrain.startTime.toString().slice(0,5),endTime:this.search.date+" "+this.bookTrain.endTime.toString().slice(0,5),passengerNames:this.orderInfo.passengers.map((t=>t.passengerName)),seatType:this.bookTrain.trainType,money:this.bookTrain.price*this.orderInfo.passengers.length,usrId:this.$store.state.user.userForm.usrId};(0,l.Z)({method:"post",url:`${o.Z.url}/usr/alipay`,data:t}).then((t=>{this.alipay=t.data.data,console.log(this.$refs.alipay),this.$nextTick((()=>{this.$refs.alipay.children[0].submit()}))})).catch((t=>{console.log(t)}))}else this.$message({message:"暂不支持改支付方式",type:"warning"})},timeFilter(t,e){let i=Date.parse(`1900-01-01 ${t.toString().slice(0,5)}`),a=Date.parse(`1900-01-01 ${e.toString().slice(0,5)}`),r=a-i,s=Math.floor(r/36e5),n=Math.floor((r-36e5*s)/6e4),l=Math.floor((r-36e5*s-6e4*n)/1e3);return`${s.toString().padStart(2,0)}:${n.toString().padStart(2,0)}:${l.toString().padStart(2,0)}`},compareTime(t){let e=Date.parse(`1900-01-01 ${t[0].trainLeaveTime.toString().slice(0,5)}`),i=Date.parse(`1900-01-01 ${t[1].trainArriveTime.toString().slice(0,5)}`),a="",r="";if(t.length>2&&(a=Date.parse(`1900-01-01 ${t[2].trainLeaveTime.toString().slice(0,5)}`),r=Date.parse(`1900-01-01 ${t[3].trainArriveTime.toString().slice(0,5)}`)),e>i||a>r)return!0},showType(t){(0,l.Z)({method:"post",url:`${o.Z.url}/train/query-train-seat`,headers:{token:localStorage.getItem("token")},data:{trainNumberId:this.trains[t][this.trains[t].length-1].trainNumberId,day:this.search.date,startStation:this.search.from[2],endStation:this.search.to[2]}}).then((e=>{console.log(e.data.data);let i=e.data.data;this.$nextTick((()=>{this.trains[t]={...this.trains[t],seat:{lseat:i[0],mseat:i[1],hseat:i[2],tseat:i[3]}},this.trainsPart=this.trains.slice(0,this.limit)}))}))}},activated(){setTimeout((()=>{this.$refs.headBackground.style.height="400px",this.loading=!1}),500)},deactivated(){this.loading=!0,this.isShow=!1}},p=c,d=i(1001),h=(0,d.Z)(p,a,r,!1,null,"4444ca33",null),g=h.exports}}]);
//# sourceMappingURL=15.963c1a5b.js.map